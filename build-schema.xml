<?xml version="1.0"?>
<project name="${project.name}" basedir=".">

<property file="build.properties"/>
	
<path id="hibernate.classpath">
  <fileset dir="${lib.dir}">
    <include name="**/*.jar"/>
    <exclude name="**/*javadoc*"/>
    <exclude name="**/*source*"/>
    <exclude name="**/*test*"/>
  </fileset>
  <fileset dir="${dist.dir}">
    <include name="**/*.jar"/>
    <exclude name="**/*javadoc*"/>
    <exclude name="**/*source*"/>
    <exclude name="**/*test*"/>
  </fileset>
</path>

<taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask" classpathref="hibernate.classpath" />
<target name="schemaexport" description="Exports a generated schema to DB and file">
	<property name="myclasspath" refid="hibernate.classpath"/>
	<!-- Emit the property to the ant console -->
	<echo message="Classpath = ${myclasspath}"/>
	
	<path id="schemaExportClasspath">
	  <path refid="hibernate.classpath"/>
	  <fileset file="${dist.dir}/${project.name}.jar" />
	</path>
	
    <hibernatetool destdir="${basedir}/src/resources">
      <classpath refid="schemaExportClasspath"/>
      <annotationConfiguration configurationfile="${basedir}/src/resources/hibernate.cfg.xml"/>
      <hbm2ddl outputfilename="${project.name}-schema.sql" export="false" update="false" drop="true" create="true"/>
    </hibernatetool>
	<replace file="${basedir}/src/resources/${project.name}-schema.sql">
    	<replacefilter token="create table ID_Sequences ( sequence_name varchar(255),  sequence_next_hi_value integer );" value="create table ID_Sequences ( sequence_name varchar(255),  sequence_next_hi_value bigint );"/>
    </replace>
</target>

<target name="create-default-users" description="Inserts to create some default users">
<delete file="${basedir}/src/resources/${project.name}-default-users.sql"/>
<echo file="${basedir}/src/resources/${project.name}-default-users.sql">
insert into User(id, email, password) values ('admin-id', 'admin@ut.org', 'password');
insert into User(id, email, password) values ('lst-id', 'lst@ut.org', 'password');
insert into User(id, email, password) values ('ast-id', 'ast@ut.org', 'password');
insert into User(id, email, password) values ('narrator-id', 'narrator@ut.org', 'password');
insert into User(id, email, password) values ('patron-id', 'patron@ut.org', 'password');
insert into User(id, email, password) values ('user-id', 'user@ut.org', 'password');

insert into User_roles(user_id, roles) values ('admin-id', 0);
insert into User_roles(user_id, roles) values ('admin-id', 5);

insert into User_roles(user_id, roles) values ('lst-id', 1);
insert into User_roles(user_id, roles) values ('lst-id', 4);
insert into User_roles(user_id, roles) values ('lst-id', 5);

insert into User_roles(user_id, roles) values ('ast-id', 2);
insert into User_roles(user_id, roles) values ('ast-id', 4);
insert into User_roles(user_id, roles) values ('ast-id', 5);

insert into User_roles(user_id, roles) values ('narrator-id', 3);
insert into User_roles(user_id, roles) values ('narrator-id', 4);
insert into User_roles(user_id, roles) values ('narrator-id', 5);

insert into User_roles(user_id, roles) values ('patron-id', 4);
insert into User_roles(user_id, roles) values ('patron-id', 5);

insert into User_roles(user_id, roles) values ('user-id', 5);

insert into Troupe(id, name, setting) values(1, 'Cam Troupe', 0);
insert into Troupe(id, name, setting) values(2, 'Anarch Troupe', 1);
insert into Troupe(id, name, setting) values(3, 'Sabbat Troupe', 2);
	
insert into ID_Sequences(sequence_name, sequence_next_hi_value) values('troupe', 50);
</echo>
</target>
</project>
